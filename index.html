<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Exclusive Discount Pop-Up</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="popup-container">
    <div class="popup-title" id="popupTitle">Unlock Your Exclusive Discount!</div>
    <p id="discountText">Save up to <span class="discount-text">45%</span> instantly on your subscription.</p>
    <input type="text" id="cardInput" class="input-field" maxlength="9" placeholder="Enter first 9 digits" oninput="this.value=this.value.replace(/[^0-9]/g,'');"> 
    <button class="check-button" id="checkButton" onclick="validateCard()">Claim Offer</button>
    <div class="loader" id="loader"></div>
    <div id="resultMessage" class="result-box"></div>
    <div class="coupon-box" id="couponBox">
      <div class="coupon-code" id="couponCode">FIRST30</div>
      <button class="copy-subscribe-btn" onclick="copyAndRedirect()">Redeem Now</button>
      <p class="copy-message" id="copyMessage">✅ Copied to clipboard!</p>
    </div>
    <div class="no-thanks">No, Thanks</div>
  </div>

  <script>
    function isValidCardInput(cardNumber) {
      if (!/^\d{9}$/.test(cardNumber)) return false;

      const firstTwo = parseInt(cardNumber.slice(0, 2), 10);
      const firstFour = parseInt(cardNumber.slice(0, 4), 10);
      const firstOne = parseInt(cardNumber.slice(0, 1), 10);

      if (firstOne === 4) return true; // Visa
      if ((firstTwo >= 51 && firstTwo <= 55) || (firstFour >= 2221 && firstFour <= 2720)) return true; // MasterCard
      if ([34, 37].includes(firstTwo)) return true; // AmEx
      if ([60, 65, 81].includes(firstTwo)) return true; // RuPay
      return false;
    }

    function validateCard() {
      const cardInput = document.getElementById("cardInput").value;
      const loader = document.getElementById("loader");
      const result = document.getElementById("resultMessage");
      const couponCode = document.getElementById("couponCode");
      const popupTitle = document.getElementById("popupTitle");
      const inputField = document.getElementById("cardInput");
      const checkButton = document.getElementById("checkButton");
      const discountText = document.getElementById("discountText");
      const couponBox = document.getElementById("couponBox");

      if (!isValidCardInput(cardInput)) {
        result.innerHTML = "❌ Invalid card number. Please try again.";
        result.style.color = "red";
        return;
      }

      loader.style.display = "block";
      result.innerHTML = "";

      setTimeout(() => {
        loader.style.display = "none";
        result.innerHTML = "⚡ Use code <b>FIRST30</b> to get 30% off!";
        result.style.color = "#5588D1";
        couponCode.innerText = "FIRST30";

        popupTitle.innerText = "Congratulations!";
        inputField.style.display = "none";
        checkButton.style.display = "none";
        discountText.style.display = "none";
        couponBox.style.display = "flex";
      }, 3000); // Show loading animation for 3 seconds
    }

    function copyAndRedirect() {
      const couponCode = document.getElementById("couponCode").textContent;

      // Copy the coupon code to the clipboard
      navigator.clipboard.writeText(couponCode).then(() => {
        // Show the "Copied to clipboard" message
        const copyMessage = document.getElementById("copyMessage");
        copyMessage.style.display = "block";

        // Redirect to a specific URL after a short delay
        setTimeout(() => {
          window.location.href = "https://www.getcaramel.ai"; // Replace with your actual URL
        }, 1000);
      }).catch(err => {
        console.error("Failed to copy coupon code: ", err);

        // Fallback: Redirect even if copying fails
        window.location.href = "https://www.getcaramel.ai";
      });
    }
  </script>
</body>
</html>